syntax = "proto3";

// This directive gets ignored for Golang generated code, but other languages may need it
package packets;

// Compile to the pkg/packets folder and use "packets" as the go package
option go_package = "pkg/packets";

// PACKET TYPES
// Building blocks
message Position { uint64 x = 1; uint64 z = 2; } // Used by other packets
// Chat
message PublicMessage { string nickname = 1; string text = 2; } // Sent by client to communicate with other clients in the area
// Connection
message Handshake { string version = 1; } // Sent by server after client connects
message Heartbeat {} // Used to keep connection alive
// Authentication
message ServerMetrics { uint64 players_online = 1; } // Sent by the server before login
message RequestGranted {} // Sent by server if request was successful
message RequestDenied { string reason = 1; } // Sent by server if request was unsuccessful
message LoginRequest { string username = 1; string password = 2; } // Sent by client to login
message RegisterRequest { // Sent by client to register
  string username = 1;
  string nickname = 2;
  string password = 3;
  string gender = 4;
}
message LoginSuccess { string nickname = 1; } // Sent by the server after successful login
message LogoutRequest {} // Sent by client
// Notifies
message ClientEntered { string nickname = 1; } // Sent by the client once his client is ready, broadcasted to everyone
message ClientLeft { string nickname = 2; } // Broadcast by the server if a client leaves
// Region
message JoinRegionRequest { uint64 region_id = 1; } // Sent by the client to request joining a new region
message RegionData { // Sent by the server as metadata (grid data, static obstacles, gates)
  uint64 region_id = 1;
  uint64 grid_width = 2;
  uint64 grid_height = 3;
}
// Character
message SpawnCharacter { // Sent by the server to spawn a character
  uint64 id = 1; // We need the client_id here so it matches on the client
  string name = 2;
  Position position = 3;
  double rotation_y = 4;
  string gender = 5;
  uint64 speed = 6;
  uint64 health = 7;
  uint64 max_health = 8;
  uint64 current_weapon = 9; // Current equipped weapon by slot
  repeated WeaponSlot weapons = 10; // All weapon slots
  bool is_crouching = 11;
}
// Character movement
message MoveCharacter { // Sent by the server to move remote characters
  Position position = 1;
}
message RotateCharacter { // Sent to rotate our character
  double rotation_y = 1;
  bool await_rotation =2;
}
// Target Destination sent by the client (Ignores Y axis (vertical))
message Destination { uint64 x = 1; uint64 z = 2; }
message UpdateSpeed { uint64 speed = 1; }
message ChatBubble { bool is_active = 1; }
// Character Equipped Weapon Data
message SwitchWeapon {
  uint64 slot = 1;
}
// Weapon Slot Data
message WeaponSlot {
  uint64 slot_index = 1;
  string weapon_name = 2;
  string weapon_type = 3;
  string display_name = 4;
  uint64 ammo = 5;
  uint64 fire_mode = 6;
}
// Reload weapon slot
message ReloadWeapon {
  uint64 slot = 1; // Weapon slot being reloaded
  uint64 amount = 2; // Amount of ammo to reload
}
message RaiseWeapon {}
message LowerWeapon {}
message FireWeapon { // We pass the hit position
  float x = 1;
  float y = 2;
  float z = 3;
}
message ToggleFireMode {}
message ReportPlayerDamage {
  uint64 target_id = 1; // ID of the player that got hit
  float x = 2; // X hit position
  float y = 3; // Y hit position
  float z = 4; // Z hit position
  bool is_critical = 5; // Critical damage (usually headshots)
}
message ApplyPlayerDamage {
  uint64 attacker_id = 1; // In case we want to draw a marker with the attacker's direction in the target's screen
  uint64 target_id = 2; // So everyone can reduce the health of this player on this screens
  uint64 damage = 3; // The damage number to apply
  string damage_type = 4; // If we want to draw different damage colors/effects
  bool is_critical = 5; // Critical damage (usually headshots)
  float x = 6; // X hit position
  float y = 7; // Y hit position
  float z = 8; // Z hit position
}
message PlayerDied {
  uint64 attacker_id = 1; // ID of the player that killed them (0 if environment death)
  uint64 target_id = 2; // ID of the player who died
}
message RespawnRequest {
  uint64 region_id = 1; // Default to the current region for now
  uint64 x = 2; // Optional: if provided, try to respawn at this position
  uint64 z = 3; // Optional: if provided, try to respawn at this position
}
message CrouchCharacter {
  bool is_crouching = 1; // True if character is crouching
}

// Main Packet container
message Packet {
  uint64 sender_id = 1;
  oneof payload { // Generates a field called Payload of type isPacket_Payload interface
    // Chat
    PublicMessage public_message = 2; // Both
    // Connection
    Handshake handshake = 3; // Server
    Heartbeat heartbeat = 4; // Both
    // Authentication
    ServerMetrics server_metrics = 5; // Server
    RequestGranted request_granted = 6; // Server
    RequestDenied request_denied = 7; // Server
    LoginRequest login_request = 8; // Client
    RegisterRequest register_request = 9; // Client
    LoginSuccess login_success = 10; // Server
    LogoutRequest logout_request = 11; // Client
    // Notifies
    ClientEntered client_entered = 12; // Both [Change this to be Server only!]
    ClientLeft client_left = 13; // Server
    // Region
    JoinRegionRequest join_region_request = 14; // Client
    RegionData region_data = 15; // Server
    // Character
    SpawnCharacter spawn_character = 16; // Server
    MoveCharacter move_character = 17; /// Server
    RotateCharacter rotate_character = 18; // Both
    Destination destination = 19; // Both
    UpdateSpeed update_speed = 20; // Both
    ChatBubble chat_bubble = 21; // Both
    // Character Equipped Weapon Data
    SwitchWeapon switch_weapon = 22; // Both
    ReloadWeapon reload_weapon = 23; // Both
    RaiseWeapon raise_weapon = 24; // Both
    LowerWeapon lower_weapon = 25; // Both
    FireWeapon fire_weapon = 26; // Both
    ToggleFireMode toggle_fire_mode = 27; // Both
    // Damage
    ReportPlayerDamage report_player_damage = 28; // Client
    ApplyPlayerDamage apply_player_damage = 29; // Server
    // Death
    PlayerDied player_died = 30; // Server
    // Respawn
    RespawnRequest respawn_request = 31; // Client
    // Crouch
    CrouchCharacter crouch_character = 32; // Both
  }
}